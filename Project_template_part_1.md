Это шаблон для решения **первой части** проектной работы. Структура этого файла повторяет структуру заданий. Заполняйте его по мере работы над решением.

# Задание 1. Анализ и планирование

Чтобы составить документ с описанием текущей архитектуры приложения, можно часть информации взять из описания компании условия задания. Это нормально.

### 1. Описание функциональности монолитного приложения

**Управление отоплением:**

- Пользователи могут удалённо включать и выключать отопление в своих домах через веб-интерфейс.  
- Система поддерживает отправку команд управления устройствам отопления.  
- Управление осуществляется через синхронные запросы от центрального сервера к устройствам.  
- Каждая команда требует подтверждения выполнения от устройства.  
- Подключение устройств осуществляется только с помощью специалиста, который выезжает на объект.  

**Мониторинг температуры:**

- Пользователи могут просматривать текущую температуру в своих домах через веб-интерфейс.  
- Система поддерживает запрос данных о температуре с датчиков, установленных в домах.  
- Датчики отправляют данные только по запросу сервера (синхронное взаимодействие).  
- Исторические данные о температуре не сохраняются, доступен только текущий показатель.  
- Для функционирования датчиков их также необходимо подключать с помощью специалиста.  

### 2. Анализ архитектуры монолитного приложения

- Язык программирования: Java  
Приложение написано на Java, что позволяет использовать богатую экосистему инструментов и библиотек для разработки.

- База данных: PostgreSQL  
Используется реляционная база данных для хранения данных о системах отопления и температурных датчиках.  

- Работа с данными:  
  - Данные о системах отопления и температурах хранятся в двух таблицах:  
    - heating_systems для информации об отопительных системах.  
    - temperature_sensors для данных о температурных датчиках.  
  - Доступ к данным осуществляется через репозитории HeatingSystemRepository и TemperatureSensorRepository.

- Архитектура:  
  - Монолитная: Все компоненты (контроллеры, бизнес-логика, доступ к данным) находятся в одном приложении, что затрудняет внесение изменений и добавление новых функций.  
  - Слои:  
    - Контроллеры для обработки HTTP-запросов.  
    - Сервисы для бизнес-логики (HeatingSystemService, HeatingSystemServiceImpl).  
    - Репозитории для доступа к данным (HeatingSystemRepository, TemperatureSensorRepository).  
    - Код жестко связан, что затрудняет внесение изменений или добавление новых функций.  

- Взаимодействие:  
  - Синхронное: Вся обработка запросов выполняется последовательно  (например, контроллер вызывает сервис, который обращается к репозиторию), что приводит к проблемам с производительностью при большом количестве запросов.  
  - Прямое управление: Контроллеры напрямую вызывают сервисы, а те — репозитории.  
  - Все операции выполняются в рамках одного процесса, что создает узкие места при увеличении нагрузки.  

- Масштабируемость:  
  - Ограничена, так как монолит сложно разделить на отдельные части для масштабирования.  
  - Увеличение нагрузки может потребовать увеличения ресурсов для всей системы, даже если нагрузка возрастает только на одну часть (например, на получение температуры).  

- Развёртывание:  
  - Приложение разворачивается как единое целое.  
  - Для внесения изменений необходимо остановить всю систему, внести изменения и перезапустить приложение.  

- Функциональность:  
  - Управление отоплением: включение/выключение системы, установка температуры.  
  - Мониторинг температуры: получение текущей температуры через запросы.   

- Управление устройствами:  
  - Устройства жёстко связаны с системой через ID.  
  - Подключение новых устройств или изменение логики требует изменения кода и повторного развёртывания.  

- Гибкость и расширяемость:     
  - Низкая гибкостьиз-за жесткой связности компонентов. Текущая архитектура не позволяет легко добавлять новые функции, например, управление освещением или воротами.  
  - Добавление новых функций или модулей требует изменения основного кода и часто затрагивает другие части системы. 

- Интеграция с устройствами:  
  - Устройства жёстко связаны с системой, их подключение осуществляется вручную специалистами.  
  - Пользователь не может самостоятельно добавить или настроить устройства.  

- Слабые стороны:  
  - Жёсткая связность: Компоненты тесно связаны друг с другом.  
  - Ограниченная модульность: Изменения в одной части приложения могут затронуть другие.  
  - Ограниченная интеграция: Поддержка только фиксированных функций без возможности динамического подключения новых модулей.  

- Сильные стороны:  
  - Простота начального развертывания и настройки.  
  - Централизованное управление всеми функциями через единое приложение.  

#### Итог  
Монолитная архитектура ограничивает гибкость и масштабируемость приложения. Она усложняет добавление новых функций, подключение новых устройств и требует значительных усилий для внесения изменений. Для достижения целей целевой экосистемы необходимо переходить на модульную архитектуру с использованием микросервисов.


### 3. Определение доменов и границы контекстов

Выделенные домены и границы контекстов

#### Домен «Управление отоплением»

**Описание:**
Управление системами отопления в домах, включая включение/выключение отопления, установку целевой температуры и получение текущей температуры.

**Основные сущности:** 
HeatingSystem: отвечает за статус отопительной системы (включено/выключено), целевую и текущую температуру.

**Основные процессы:**
Включение/выключение отопления.
Настройка целевой температуры.
Чтение текущей температуры.

**Границы контекста:**
Этот домен покрывает только функции, связанные с управлением отопительными устройствами.

**На что можно опираться из текущего решения:** 
Бизнес-логика в HeatingSystemService.
REST-методы в контроллере для управления отоплением.

#### Домен «Мониторинг температуры»

**Описание:**
Сбор и предоставление данных о текущей температуре в доме.

**Основные сущности:** 
TemperatureSensor: представляет датчики температуры и их данные.

**Основные процессы:**
Получение текущей температуры с датчиков.
Отображение температуры пользователю.

**Границы контекста:**
Этот домен включает только сбор и обработку данных с температурных датчиков.

**На что можно опираться из текущего решения:** 
Репозиторий TemperatureSensorRepository.
Методы в контроллере, связанные с получением данных о температуре.

#### Домен «Интеграция устройств»

**Описание:**
Процесс добавления и подключения устройств к системе, включая их первоначальную настройку.

**Основные сущности:** 
Устройства (датчики и реле) в контексте будущей экосистемы.

**Основные процессы:**
Подключение новых устройств.
Настройка и активация устройств пользователем.

**Границы контекста:**
В текущем решении это покрывается выездом специалиста. В новой системе это станет отдельным доменом с акцентом на самообслуживание.

**На что можно опираться из текущего решения:** 
Текущая логика работы с устройствами в монолите.

#### Домен «Управление умным домом» (будущее расширение)

**Описание:**
Управление другими устройствами в доме, включая освещение, ворота, системы безопасности и т.д.

**Основные сущности:** 
Модули умного дома: свет, ворота, камеры наблюдения.

**Основные процессы:**
Управление каждым модулем через отдельный сервис.
Настройка сценариев автоматизации.

**Границы контекста:**
В новой системе это будет отдельный домен для управления дополнительными устройствами.

**На что можно опираться из текущего решения:** 
Логика управления отоплением может быть переработана и применена для управления другими модулями.

#### Домен «Пользовательский доступ»

**Описание:**
Управление доступом пользователей к системе и настройка их взаимодействия с устройствами.

**Основные сущности:** 
Учетные записи пользователей.
Права доступа к устройствам и данным.

**Основные процессы:**
Авторизация и аутентификация пользователей.
Назначение прав доступа к устройствам.

**Границы контекста:**

Этот домен будет включать в себя авторизация и аутентификация пользователей, а также назначение прав доступа к устройствам.
В текущем решении этот домен отсутствует. Его необходимо добавить для поддержки самостоятельного управления пользователями и их устройствами.

#### Вывод
Текущая система явно поддерживает только два домена: «Управление отоплением» и «Мониторинг температуры». В новой архитектуре потребуется выделить дополнительные домены, включая «Интеграцию устройств», «Управление умным домом» и «Пользовательский доступ», чтобы достичь целевой модульности и самообслуживания.

### 4. Проблемы монолитного решения

##### Общие ограничения  

- Система не поддерживает самостоятельное подключение устройств пользователем.  
- Архитектура монолитная, что усложняет добавление новых функций и масштабирование.  
- Поддерживаются только устройства для управления отоплением.  
- Нет асинхронного взаимодействия, что снижает производительность и масштабируемость.

##### Технические ограничения

1. Монолитная архитектура:
   - Всё приложение представляет собой один модуль, что затрудняет добавление нового функционала (например, управление другими устройствами).
   - Обновление одной части приложения требует пересборки и развертывания всей системы.

2. Нет модульности и масштабируемости:
   - Все функции (управление отоплением, мониторинг) жёстко связаны, что делает систему менее гибкой.
   - При большом количестве подключений сервер может стать узким местом.

3. Синхронное взаимодействие:
   - Использование синхронных запросов  делает систему медленной и ограничивает её производительность.

##### Функциональные ограничения

1. Ограниченная поддержка устройств:
   - Только устройства для отопления поддерживаются текущей версией системы.
   - Нет возможности добавлять новые типы умных устройств.

2. Зависимость от специалистов:
   - Подключение устройств требует выезда специалиста, что неудобно для пользователей и увеличивает затраты компании.

3. Нет поддержки самостоятельного подключения:
   - Пользователь не может сам зарегистрировать устройство в системе.

#### Проблемы монолитного решения в контексте текущих бизнес-задач  

Монолитная архитектура текущего приложения создаёт ряд препятствий для достижения целей бизнеса. Рассмотрим их подробно:  

##### 1. Невозможность масштабирования  
- Привязка к специалистам: Подключение устройств требует выезда сотрудников компании, что невозможно масштабировать до уровня целевой экосистемы. Для обслуживания сотен поселков это станет экономически и операционно невыгодным.  
- Централизованный сервер: Все операции проходят через единый сервер, который не справится с одновременной нагрузкой от тысяч устройств и пользователей. Это ограничивает способность системы обслуживать 100 экопосёлков и 200 домов в каждом.  
- Синхронные запросы: Текущая модель синхронных вызовов усложняет масштабирование, так как система должна обрабатывать каждое подключение последовательно.  

##### 2. Отсутствие модульности  
- Жёсткая структура: Монолит не поддерживает добавление новых типов устройств (освещение, ворота, камеры). Все изменения требуют изменения всего кода, что замедляет разработку и тестирование.  
- Сложность расширения: Целевая экосистема требует модульной архитектуры, где можно легко добавлять новые функциональные блоки. В текущей системе этого достичь невозможно.  
- Риск ошибок: Любое изменение в одной части монолита может привести к сбоям в других, что увеличивает вероятность ошибок при разработке.  

##### 3. Ограничение возможностей самообслуживания  
- Нет самостоятельного подключения: Пользователи не могут самостоятельно добавлять или подключать устройства, что противоречит модели самообслуживания SaaS. Это снижает привлекательность продукта.  
- Нет настройки сценариев: Система не предоставляет пользователю возможности программировать сценарии работы устройств. Это ограничивает гибкость использования экосистемы.  

##### 4. Сложности с интеграцией устройств партнёров  
- Нет поддержки стандартных протоколов: Текущая система не поддерживает универсальные протоколы для взаимодействия с устройствами от разных производителей. Это усложняет подключение партнёрских устройств.  
- Привязка к специфическим устройствам: Все устройства требуют ручной настройки, что снижает удобство использования и ограничивает выбор устройств для пользователей.  

##### 5. Ограничения производительности и надёжности  
- Единая точка отказа: Централизованный сервер становится узким местом и единой точкой отказа, что недопустимо в системе, рассчитанной на тысячи устройств.  
- Нет асинхронного взаимодействия: Асинхронная обработка необходима для работы с большим числом событий и устройств. Без неё система становится менее отзывчивой.  
- Нет мониторинга и аналитики: Система не сохраняет историю данных, что делает невозможным построение аналитики и диагностики проблем.  

##### 6. Сложности разработки и развертывания  
- Долгий цикл разработки: Внесение изменений в монолит требует тестирования и деплоя всей системы, что увеличивает время вывода новых функций.  
- Отсутствие CI/CD: В текущей системе нет автоматизации сборки и развертывания, что усложняет поддержание стабильности и скорости релизов.  

#### Вывод  
Монолитное решение не соответствует текущим бизнес-целям компании из-за ограничений в масштабируемости, гибкости и скорости разработки. Для достижения целевой экосистемы необходимо перейти к модульной архитектуре с микросервисами, поддержкой стандартных протоколов и возможностью самостоятельного подключения устройств пользователями.

### 5. Визуализация контекста системы — диаграмма С4

Диаграмма контекста монолитного приложения представлена в файле MonoliteContextDiagram.puml текущего проекта

```markdown
[MonoliteContextDiagram](./diagrams/MonoliteContextDiagram.puml)
```

# Задание 2. Проектирование микросервисной архитектуры

В этом задании вам нужно предоставить только диаграммы в модели C4. Мы не просим вас отдельно описывать получившиеся микросервисы и то, как вы определили взаимодействия между компонентами To-Be системы. Если вы правильно подготовите диаграммы C4, они и так это покажут.

**Диаграмма контейнеров (Containers)**

```markdown
[ContainersDiagram](./diagrams/ContainersDiagram.puml)
```

**Диаграмма компонентов (Components)**

1. Диаграмма для микросервиса управления устройствами API_Gateway Device Management

```markdown
[APIGatewayDeviceManagementComponents](./diagrams/ComponentsDiagrams/APIGatewayDeviceManagementComponents.puml)
```

2. Диаграмма для микросервиса настройка автоматических сценариев Automation_Service

```markdown
[AutomationServiceComponents](./diagrams/ComponentsDiagrams/AutomationServiceComponents.puml)
```

3.  Диаграмма для микросервиса системы отопления Heating_System_Service

```markdown
[HeatingSystemComponents](./diagrams/ComponentsDiagrams/HeatingSystemComponents.puml)
```

4. Диаграмма для микросервиса управления освещением Lighting_System_Service
```markdown
[LightingSystemComponents](./diagrams/ComponentsDiagrams/LightingSystemComponents.puml)
```

5. Диаграмма для микросервиса уведомлений для пользователей Notification_Service

```markdown
[NotificationServiceComponents](./diagrams/ComponentsDiagrams/NotificationServiceComponents.puml)
```

6. Диаграмма для микросервиса мониторинга температуры Temperature_Monitoring_Service

```markdown
[TemperatureMonitoringComponents](./diagrams/ComponentsDiagrams/TemperatureMonitoringComponents.puml)
```


**Диаграмма кода (Code)**

1. Диаграмма на уровне кода (классов) для управления устройствами DeviceManagement

```markdown
[DeviceManagementCode](./diagrams/CodeDiagrams/DeviceManagementCode.puml)
```

2. Диаграмма на уровне кода (классов) для управления отоплением Heating_System_Service

```markdown
[HeatingSystemCode](./diagrams/CodeDiagrams/HeatingSystemCode.puml)
```


# Задание 3. Разработка ER-диаграммы

Диаграмма находится в текущем проекте, в папке diagrams

```markdown
[ER-diagram.puml](./diagrams/ER-diagram.puml)
```
